ONLINEVERSION=202205291
ONLINENAME="2022-05-29-1"
RULES="
#è´¡çŒ®åœ¨çº¿è§„åˆ™ï¼Œè”ç³»ï¼š
#QQï¼š2536554304
#é…·å®‰ï¼šæ—¶é›¨ä¸¶æ˜Ÿç©º

#ç³»ç»Ÿ
[æ¨¡å—è¯¦ç»†|é…ç½®|æ ¹è·¯å¾„/Android/Hcfile_sharing]
[ç³»ç»Ÿ|ä¸‹è½½|æ ¹è·¯å¾„/Download]
[ç³»ç»Ÿ|ç›¸å†Œ|æ ¹è·¯å¾„/DCIM]
[ç³»ç»Ÿ|éŸ³ä¹|æ ¹è·¯å¾„/Music]
[ç³»ç»Ÿ|å›¾ç‰‡|æ ¹è·¯å¾„/Pictures]

#QQ
[QQ|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.tencent.mobileqq/Tencent/QQfile_recv]
[QQ|ä¸‹è½½2|æ ¹è·¯å¾„/Tencent/QQfile_recv]
[QQ|å›¾ç‰‡|åº”ç”¨æ•°æ®è·¯å¾„/com.tencent.mobileqq/Tencent/QQ_Images]
[QQ|å›¾ç‰‡2|æ ¹è·¯å¾„/tencent/qq_images]
[QQ|è§†é¢‘|æ ¹è·¯å¾„/tencent/QQ_Video]

#TIM è´¡çŒ®ï¼š845158117
[TIM|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.tencent.tim/Tencent/TIMfile_recv]
[TIM|ä¸‹è½½2|æ ¹è·¯å¾„/Tencent/TIMfile_recv]
[TIM|å›¾ç‰‡|æ ¹è·¯å¾„/Tencent/Tim_Images]

#å¾®ä¿¡
[å¾®ä¿¡|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.tencent.mm/MicroMsg/Download]
[å¾®ä¿¡|ä¸‹è½½2|æ ¹è·¯å¾„/tencent/MicroMsg/Download]

#å®˜æ–¹ç”µæŠ¥
[ç”µæŠ¥|è§†é¢‘|åº”ç”¨æ•°æ®è·¯å¾„/org.telegram.messenger.web/files/Telegram/Telegram Video]
[ç”µæŠ¥|å›¾ç‰‡|åº”ç”¨æ•°æ®è·¯å¾„/org.telegram.messenger.web/files/Telegram/Telegram Images]
[ç”µæŠ¥|æ–‡ä»¶|åº”ç”¨æ•°æ®è·¯å¾„/org.telegram.messenger.web/files/Telegram/Telegram Documents]
[ç”µæŠ¥|éŸ³é¢‘|åº”ç”¨æ•°æ®è·¯å¾„/org.telegram.messenger.web/files/Telegram/Telegram Audio]

#äº‘ç›˜ä¸‹è½½
[äº‘ç›˜|ç™¾åº¦äº‘|æ ¹è·¯å¾„/BaiduNetdisk]
[äº‘ç›˜|ç™¾åº¦äº‘ç¼“å­˜|åº”ç”¨æ•°æ®è·¯å¾„/com.baidu.netdisk/cache/preview/BaiduNetdisk/]
[äº‘ç›˜|é˜¿é‡Œäº‘ç›˜|æ ¹è·¯å¾„/AliYunPan]
[äº‘ç›˜|å¤©ç¿¼äº‘ç›˜|æ ¹è·¯å¾„/ecloud]
[äº‘ç›˜|è…¾è®¯å¾®äº‘|æ ¹è·¯å¾„/å¾®äº‘ä¿å­˜çš„æ–‡ä»¶]
[äº‘ç›˜|æ›²å¥‡ç›˜|æ ¹è·¯å¾„/quqi/pan/download]
[äº‘ç›˜|å’Œå½©äº‘ç½‘ç›˜|æ ¹è·¯å¾„/M_Cloud/download]
[äº‘ç›˜|æ–‡å”å”|æ ¹è·¯å¾„/Wenshushu/Download]#å¤§ç™½äº‘
[äº‘ç›˜|å¤§ç™½äº‘|æ ¹è·¯å¾„/å¤§ç™½Â·Cloud]
[äº‘ç›˜|ç£åŠ›äº‘|æ ¹è·¯å¾„/happy.cloud]

#é’‰é’‰
[é’‰é’‰|é’‰é’‰æ–‡ä»¶|æ ¹è·¯å¾„/DingTalk]

#è…¾è®¯æ–‡æ¡£
[è…¾è®¯æ–‡æ¡£|ä¸‹è½½|æ ¹è·¯å¾„/TencentDocs/download]

#è¿…é›·
[è¿…é›·|è¿…é›·ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.xunlei.downloadprovider/files/ThunderDownload]

#æµè§ˆå™¨
[æµè§ˆå™¨|Chrome|åº”ç”¨æ•°æ®è·¯å¾„/com.android.chrome/files/Download]
[æµè§ˆå™¨|å¤¸å…‹|æ ¹è·¯å¾„/Quark/Download]
[æµè§ˆå™¨|å¤¸å…‹2|æ ¹è·¯å¾„/quark/download]
[æµè§ˆå™¨|UC|æ ¹è·¯å¾„/UCDownloads]
[æµè§ˆå™¨|UC2|æ ¹è·¯å¾„/UCTurbo/Download]
[æµè§ˆå™¨|X|åº”ç”¨æ•°æ®è·¯å¾„/com.mmbox.xbrowser/files/downloads]
[æµè§ˆå™¨|QQ|æ ¹è·¯å¾„/QQBrowser]
[æµè§ˆå™¨|360|æ ¹è·¯å¾„/360Browser/download]
[æµè§ˆå™¨|360æé€Ÿ|æ ¹è·¯å¾„/360LiteBrowser/download]

#ç½‘æ˜“äº‘
[ç½‘æ˜“äº‘éŸ³ä¹|æ­Œæ›²|æ ¹è·¯å¾„/netease/cloudmusic/Music]
[ç½‘æ˜“äº‘éŸ³ä¹|MV|æ ¹è·¯å¾„/netease/cloudmusic/MV]
[ç½‘æ˜“äº‘éŸ³ä¹|éŸ³ä¹ç›¸å†Œ|æ ¹è·¯å¾„/netease/cloudmusic/ç½‘æ˜“äº‘éŸ³ä¹ç›¸å†Œ]

#QQéŸ³ä¹
[QQéŸ³ä¹|æ­Œæ›²|æ ¹è·¯å¾„/qqmusic/song]
[QQéŸ³ä¹|MV|æ ¹è·¯å¾„/qqmusic/mv]

#é…·ç‹—éŸ³ä¹
[é…·ç‹—éŸ³ä¹|æ­Œæ›²|æ ¹è·¯å¾„/kgmusic/download]
[é…·ç‹—éŸ³ä¹|MV|æ ¹è·¯å¾„/kugou/mv]

#é…·æˆ‘éŸ³ä¹ è´¡çŒ®ï¼š2368801591
[é…·æˆ‘éŸ³ä¹|æ­Œæ›²|æ ¹è·¯å¾„/KuwoMusic/music]
[é…·æˆ‘éŸ³ä¹|MV|æ ¹è·¯å¾„/KuwoMusic/mvDownload]

#å¥½æ¸¸å¿«çˆ†
[å¥½æ¸¸å¿«çˆ†|æ¸¸æˆå®‰è£…åŒ…|æ ¹è·¯å¾„/Android/data/com.xmcy.hykb/files/HYKB/bazaar]
[å¥½æ¸¸å¿«çˆ†|æœ¬ä½“å‡çº§åŒ…|æ ¹è·¯å¾„/Android/data/com.xmcy.hykb/files/HYKB/version]

#è±Œè±†èš è´¡çŒ®ï¼š2495945382
[è±Œè±†èš|å®‰è£…åŒ…|æ ¹è·¯å¾„/wandoujia/downloader/apk]

#TapTap
[TapTap|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.taptap/files/Download]

#å°ç±³äº’ä¼ 
[å°ç±³äº’ä¼ |ä¸‹è½½|æ ¹è·¯å¾„/mishare]

#DJå¤šå¤š
[DJå¤šå¤š|æ­Œæ›²|æ ¹è·¯å¾„/DJDD/Download]

#å’ªå’•éŸ³ä¹
[å’ªå’•éŸ³ä¹|æ­Œæ›²|æ ¹è·¯å¾„/12530/download]

#é…·å®‰
[é…·å®‰|ä¸‹è½½|æ ¹è·¯å¾„/Android/data/com.coolapk.market/files/Download]

#ç™¾åº¦
[ç™¾åº¦|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.baidu.searchbox/files/downloads]

#ææœºåŠ©æ‰‹
[ææœºåŠ©æ‰‹|é…ç½®æ–‡ä»¶|åº”ç”¨æ•°æ®è·¯å¾„/Han.GJZS/files/Configuration_File]

#å®‰å“å£çº¸
[å®‰å“å£çº¸|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.androidesk/files/androidesk]

#æ‚Ÿé¥­æ¸¸æˆå…
[æ‚Ÿé¥­æ¸¸æˆå…|ä¸‹è½½|åº”ç”¨æ•°æ®è·¯å¾„/com.join.android.app.mgsim.wufun/files/wufan91]

#è‘«èŠ¦ä¾ 
[è‘«èŠ¦ä¾ |ä¸‹è½½|æ ¹è·¯å¾„/åº”ç”¨æ•°æ®è·¯å¾„/com.huluxia.gametools/downloads]

#çˆ±å¾æ¸¸æˆå®ç›’
[çˆ±å¾æ¸¸æˆå®ç›’|ä¸‹è½½|æ ¹è·¯å¾„/25game/apps]
"
echolog() { echo "$@" >>"$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log"; }
[ -f "$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" ] && mv "$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" "$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log.old"
echolog "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
 Hchai - ç›®å½•å®šå‘æŒ‚è½½ åœ¨çº¿è„šæœ¬
   $ONLINENAME ($ONLINEVERSION)
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
       ä½œè€…ï¼šæ—¶é›¨ğŸŒŒæ˜Ÿç©º

- æ­£åœ¨æ£€æŸ¥æ›´æ–°"
abort() {
	echolog "
! $@"
	abort "$@ åœ¨çº¿è§„åˆ™æŒ‚è½½å¤±è´¥"
}
offline() {
	echolog "
- æ­£åœ¨è®¾ç½®ç¯å¢ƒ

  å½“å‰æ—¶é—´ï¼š$DATE
  è„šæœ¬è·¯å¾„ï¼š$FILE$([ -n "$*" ] && echolog "
  é™„åŠ å‚æ•°ï¼š$*")
  è®¾å¤‡ä»£å·ï¼š$(getprop ro.product.device)
  è®¾å¤‡å‹å·ï¼š$(getprop ro.product.marketname)
  è®¤è¯å‹å·ï¼š$(getprop ro.product.model)
  å®‰å“ç‰ˆæœ¬ï¼š$(getprop ro.build.version.release) (SDK $(getprop ro.build.version.sdk))
  ç³»ç»Ÿç‰ˆæœ¬ï¼š$(getprop ro.build.version.incremental)
  æ›´æ–°æ—¶é—´ï¼š$(date -d "@$(getprop ro.build.date.utc)" "+%F %X")
  å†…æ ¸ç‰ˆæœ¬ï¼š$(uname -r)
  é¢å…·ç‰ˆæœ¬ï¼š$(magisk -c)

- æ­£åœ¨å†™å…¥åœ¨çº¿è§„åˆ™"
	echolog "$RULES"
	sed -i '/åœ¨çº¿è§„åˆ™ï¼š/,$d' "$CONF"
	echo -n "åœ¨çº¿è§„åˆ™ï¼š
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”$RULESâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" >>"$CONF"
	echolog "- å†™å…¥å®Œæˆï¼Œç”¨æ—¶ï¼š$(expr "$(date +%s)" - "$(date -d "$DATE" +%s)")ç§’"
	mount_file
}
abort_update() {
	echolog "
! $@"
	[ "$N" -lt "8" ] && {
		let N++
		download
	} || {
		echolog "
! è„šæœ¬ä¸‹è½½å¤±è´¥ï¼Œä½¿ç”¨ç¦»çº¿ç‰ˆæœ¬"
		offline
	}
}
abort_module_update() {
	echolog "
! $@"
	[ "$N" -lt "8" ] && {
		let N++
		download_module
	} || {
		echolog "
! æ¨¡å—æ›´æ–°å¤±è´¥"
		offline
	}
}
download_module() {
  server
	echolog "
  æ­£åœ¨ä» $SERVER æœåŠ¡å™¨ ä¸‹è½½ç‰ˆæœ¬ä¿¡æ¯"
	eval geturl "$URL/version" >>"$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" 2>&1 || abort_module_update "ä¸‹è½½å¤±è´¥"
	NEW="$(sed -n s/^version=//p version)"
	NEWNAME="$(sed -n s/^name=//p version)"
	MD5="$(sed -n s/^md5=//p version)"
	rm -rf version
	[ -n "$NEW" ] && [ -n "$NEWNAME" ] && [ -n "$MD5" ] || abort_module_update "ä¸‹è½½æ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯ç¼ºå¤±"
	VERSION="$(sed -n s/^versionCode=//p "$MODDIR/module.prop")"
	NAME="$(sed -n s/^version=//p "$MODDIR/module.prop")"
	echolog "
  å½“å‰ç‰ˆæœ¬å·ï¼š$VERSION
  æœ€æ–°ç‰ˆæœ¬å·ï¼š$NEW"
	if [ "$VERSION" -lt "$NEW" ]; then
		echolog "
  å‘ç°æ–°ç‰ˆæœ¬ï¼š$NEWNAME

  å¼€å§‹ä¸‹è½½æ›´æ–°"
		eval geturl "$URL/install.sh" >>"$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" 2>&1 || abort_module_update "ä¸‹è½½å¤±è´¥"
		[ "$(md5sum "install.sh" | head -c 32)" != "$MD5" ] && abort_module_update "ä¸‹è½½æ–‡ä»¶æ ¡éªŒé”™è¯¯"
		echolog "
- æ¨¡å—ä¸‹è½½å®Œæˆï¼Œå¼€å§‹å®‰è£…"
		sh "install.sh" >> "$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" 2>&1
    offline
	else
		echolog "
  å½“å‰ç‰ˆæœ¬ï¼š$NAME å·²æ˜¯æœ€æ–°"
		offline
	fi
}
download() {
	server
	echolog "
  æ­£åœ¨ä» $SERVER æœåŠ¡å™¨ ä¸‹è½½ç‰ˆæœ¬ä¿¡æ¯"
	eval geturl "$URL/Online/version" >>"$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" 2>&1 || abort_update "ä¸‹è½½å¤±è´¥"
	NEW="$(sed -n s/^version=//p version)"
	NEWNAME="$(sed -n s/^name=//p version)"
	MD5="$(sed -n s/^md5=//p version)"
	rm -rf version
	[ -n "$NEW" ] && [ -n "$NEWNAME" ] && [ -n "$MD5" ] || abort_update "ä¸‹è½½æ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯ç¼ºå¤±"
	echolog "
  å½“å‰ç‰ˆæœ¬å·ï¼š$ONLINEVERSION
  æœ€æ–°ç‰ˆæœ¬å·ï¼š$NEW"
	if [ "$ONLINEVERSION" -lt "$NEW" ]; then
		echolog "
  å‘ç°æ–°ç‰ˆæœ¬ï¼š$NEWNAME

  å¼€å§‹ä¸‹è½½æ›´æ–°"
		eval geturl "$URL/Online/Online.sh" >>"$ANDROIDH/åœ¨çº¿è§„åˆ™æ—¥å¿—.log" 2>&1 || abort_update "ä¸‹è½½å¤±è´¥"
		[ "$(md5sum "Online.sh" | head -c 32)" != "$MD5" ] && abort_update "ä¸‹è½½æ–‡ä»¶æ ¡éªŒé”™è¯¯"
		echolog "
- è„šæœ¬æ›´æ–°å®Œæˆï¼Œå¼€å§‹æ‰§è¡Œ"
		mv "$FILE" "$FILE.bak"
		mv "Online.sh" "$FILE"
		. "$FILE"
		exit
	else
		echolog "
  å½“å‰ç‰ˆæœ¬ï¼š$ONLINENAME å·²æ˜¯æœ€æ–°

- æ­£åœ¨æ£€æŸ¥æ¨¡å—æ›´æ–°"
		download_module
	fi
}
server() {
case "$N" in
	"2")
		SERVER="GitHub"
		URL="https://raw.githubusercontent.com/TimeRainStarSky/MMPack/modules/Hcfile_sharing"
		;;
	"1")
		SERVER="Gitee"
		URL="https://gitee.com/TimeRainStarSky/MMPack/raw/modules/Hcfile_sharing"
		;;
	"3")
		SERVER="Agit"
		URL="https://agit.ai/TimeRainStarSky/MMPack/raw/branch/modules/Hcfile_sharing"
		;;
	"4")
		SERVER="GitLab"
		URL="https://gitlab.com/TimeRainStarSky/MMPack/raw/modules/Hcfile_sharing"
		;;
	"5")
		SERVER="Coding"
		URL="https://trss.coding.net/p/MMPack/d/MMPack/git/raw/modules/Hcfile_sharing"
		;;
	"6")
		SERVER="Aliyun"
		URL="https://code.aliyun.com/TimeRainStarSky/MMPack/raw/modules/Hcfile_sharing"
		;;
	"7")
		SERVER="Bitbucket"
		URL="https://bitbucket.org/TimeRainStarSky/MMPack/raw/modules/Hcfile_sharing"
		;;
	"8")
		SERVER="Jsdelivr"
		URL="https://cdn.jsdelivr.net/gh/TimeRainStarSky/MMPack@modules/Hcfile_sharing"
		;;
	esac
}
DATE="$(date "+%F %X")"
cd "$(dirname "$0")"
FILE="$(realpath "U.sh")"
if command -v curl >/dev/null; then alias geturl="curl -L --retry 2 --connect-timeout 5 -O"; elif command -v wget >/dev/null; then alias geturl="wget -T 5 --no-check-certificate"; else
	echolog "
!  æ‰¾ä¸åˆ°æ›´æ–°å‘½ä»¤ï¼Œä½¿ç”¨ç¦»çº¿ç‰ˆæœ¬"
	offline
fi
N=1
download
exit